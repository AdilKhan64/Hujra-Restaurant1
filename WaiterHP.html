<!DOCTYPE html>
<html lang="en">

<head>
    <link
        href='http://fonts.googleapis.com/css?family=Roboto:400,400italic,500,500italic,700,700italic,900,900italic,300italic,300'
        rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Roboto+Slab:400,700,300,100' rel='stylesheet' type='text/css'>
    <!-- Global CSS -->
    <link rel="stylesheet" type="text/css" href="assets/admin/login-home/plugins/bootstrap/css/bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="assets/admin/login-home/plugins/font-awesome/css/font-awesome.css" />
    <link rel="stylesheet" type="text/css" href="assets/admin/login-home/css/login-home.css" />
    <title>Waiter Home Page</title>

    <style>
        @import url('https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,700');

        :root {
            --base-spacing-unit: 24px;
            --half-spacing-unit: calc(var(--base-spacing-unit) / 2);
            --color-alpha: #1772FF;
            --color-form-highlight: #844fff67;
        }

        .tbls {
            width: 100%;
            border-collapse: collapse;
            overflow: hidden;
            border-radius: 10px;
            margin-bottom: 10px;
        }

        .tbls th {
            color: white;
            background-color: #854fff;
            padding: 9px;
        }

        .tbls tbody {
            background-color: white;
        }

        .un-fill {
            padding: 9px;
            color: black;
        }

        .fill {
            border-radius: 10px;
            padding: 9px;
            margin: 2px;
            background-color: rgba(255, 0, 0, 0.715);
        }


        .table-header {
            display: flex;
            border-top-left-radius: 10px;
            border-top-right-radius: 10px;
            width: 100%;
            background: #854fff;
            padding: calc(var(--half-spacing-unit) * 1.5) 0;
        }

        .table-row {
            display: flex;
            width: 100%;
            padding: calc(var(--half-spacing-unit) * 1.5) 0;
        }

        .table-row:nth-of-type(even) {
            background: #dcceff;
            color: #000;
        }

        .table-row:nth-of-type(odd) {
            background: white;
            color: #000;
        }

        .table-data,
        .header__item {
            flex: 1 1 20%;
            text-align: center;
        }

        .filter__link {
            color: white;
            text-decoration: none;
            position: relative;
            display: inline-block;
            padding-left: var(--base-spacing-unit);
            padding-right: var(--base-spacing-unit);
        }

        .filter__link::after {
            content: '';
            position: absolute;
            right: calc(-var(--half-spacing-unit) * 1.5);
            color: white;
            font-size: var(--half-spacing-unit);
            top: 50%;
            transform: translateY(-50%);
        }

        .filter__link.desc::after {
            content: '(desc)';
        }

        .filter__link.asc::after {
            content: '(asc)';
        }

        .button-1 {
            background-color: #854fff;
            border-radius: 8px;
            border-style: none;
            box-sizing: border-box;
            color: #FFFFFF;
            cursor: pointer;
            display: inline-block;
            font-family: "Haas Grot Text R Web", "Helvetica Neue", Helvetica, Arial, sans-serif;
            font-size: 14px;
            font-weight: 500;
            height: 40px;
            width: 100%;
            line-height: 20px;
            list-style: none;
            margin: 0;
            outline: none;
            padding: 10px 16px;
            position: relative;
            text-align: center;
            text-decoration: none;
            transition: color 100ms;
            vertical-align: baseline;
            user-select: none;
            -webkit-user-select: none;
            touch-action: manipulation;
        }

        .button-1:hover,
        .button-1:focus {
            background-color: #F082AC;
        }
    </style>

</head>

<body class="login-page access-page has-full-screen-bg">
    <div class="upper-wrapper">

        <!--Log out button-->
        <div style="display: flex; justify-content: flex-end;">
            <a onclick="LogOut()" class="text-center" style="color: white; padding: 20px; cursor: pointer !important;">
                <i class="fa fa-sign-out"></i>
                Logout
            </a>
        </div>


        <section class="login-section ">
            <div class="container">
                <div class="row">
                    <div class="form-box   col-xs-12 col-md-12">
                        <div class="form-box-inner">
                            <div class="row">
                                <div class="form-container  col-xs-2 col-md-2;">
                                    <table class="tbls">
                                        <thead>
                                            <th style="text-align: center; font-weight: bold;">Tables</th>
                                        </thead>
                                    </table>
                                    <table class="tbls">
                                        <tbody style="text-align:center">

                                        </tbody>
                                    </table>
                                </div>
                                <!--Buttons and There Boxes-->
                                <div class="form-container  col-xs-9 col-md-9">

                                    <div class="logo-top action-title-container"
                                        style="background: rgba(123, 123, 123, 0.79); padding: 35px; border-radius: 20px;">
                                        <form id="waiterDataForm" class="" name="form-work" action="#">
                                            <br>
                                            <div class="form-group row">
                                                <label for="billno" class="col-sm-1 col-form-label">Bill No</label>
                                                <div class="col-sm-3">
                                                    <input id="order-bill-no" type="text" class="form-control"
                                                        id="billno" placeholder="Bill No" readonly>
                                                </div>
                                                <label for="date" class="col-sm-1 col-form-label">Date</label>
                                                <div class="col-sm-3">
                                                    <input id="order-date" type="date" class="form-control" id="date"
                                                        placeholder="DD/MM/Year">
                                                </div>

                                                <label for="inputPassword3" class="col-sm-1 col-form-label">Time</label>
                                                <div class="col-sm-3">
                                                    <input id="order-time" type="time" class="form-control"
                                                        id="inputPassword3" placeholder="H:M">
                                                </div>
                                            </div>
                                            <div class="form-group row">
                                                <label for="inputEmail3" class="col-sm-1 col-form-label">Name</label>
                                                <div class="col-sm-3">
                                                    <input id="order-name" type="text" class="form-control"
                                                        id="inputEmail3" placeholder="Name">
                                                </div>
                                                <label for="order-" class="col-sm-1 col-form-label">Mobile</label>
                                                <div class="col-sm-3">
                                                    <input id="order-mobile-no" type="text" class="form-control"
                                                        id="inputPassword3" placeholder="+92-----------">
                                                </div>
                                                <label for="inputPassword3"
                                                    class="col-sm-1 col-form-label">Table</label>
                                                <div class="col-sm-3">
                                                    <select id="order-table" class="form-control" name="table">
                                                        <option>Select Table</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <br>

                                            <div class="form-group row">
                                                <label for="message" class="col-sm-1 col-form-label">Message</label>
                                                <div class="col-sm-11">
                                                    <textarea id="order-message" class="form-control" rows="5" placeholder="(Optional) Enter Your message here...."></textarea>
                                                </div>
                                                
                                            </div>
                                            <br>

                                            <div class="form-group row ">
                                                <label for="inputPassword3" class="col-sm-1 col-form-label">Menu</label>
                                                <div class="col-sm-3">
                                                    <select id="menu-items" class="form-control" name="table">
                                                        <option>Select Menu</option>

                                                    </select>
                                                </div>
                                                <label for="inputEmail3"
                                                    class="col-sm-1 col-form-label">Quantity</label>
                                                <div class="col-sm-3">
                                                    <input id="menue-quantity" type="number" class="form-control"
                                                        placeholder="e.g. 12">
                                                </div>
                                                <div class="col-sm-3">
                                                    <input type="submit" style="margin-top: -2px; border-radius: 10px;"
                                                        class="btn btn-block bg-success " id="btnn" value="Add Item">
                                                </div>

                                            </div>
                                            <br>

                                        </form>


                                    </div>
                                    <div class="clear"></div>

                                    <br>


                                    <div class="table">
                                        <div class="table-header">
                                            <div class="header__item"><a id="name" class="filter__link" href="#">S
                                                    No.</a></div>
                                            <div class="header__item"><a id="wins"
                                                    class="filter__link filter__link--number" href="#">Menu</a>
                                            </div>
                                            <div class="header__item"><a id="draws"
                                                    class="filter__link filter__link--number" href="#">Unit Price</a>
                                            </div>
                                            <div class="header__item"><a id="losses"
                                                    class="filter__link filter__link--number" href="#">Quantity</a>
                                            </div>
                                            <div class="header__item"><a id="total"
                                                    class="filter__link filter__link--number" href="#">Total Price</a>
                                            </div>
                                        </div>
                                        <div class="table-content">

                                        </div>
                                    </div>


                                    <!-- HTML !-->
                                    <button class="button-1" id="pace-order" role="button">Place Order</button>
                                    <br>
                                    <br>

                                </div><!--//form-container-->



                            </div><!--//form-box-->
                        </div><!--//row-->
                    </div><!--//container-->
        </section><!--//contact-section-->
    </div><!--//upper-wrapper-->

    <!-- Auto Generate Bill Number -->
    <script>
        function getCurrentTimestamp() {
            return "RMS#" + Date.now();
        }

        document.getElementById('order-bill-no').value = getCurrentTimestamp();
    </script>

    <!-- SweetAlert2 Library -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <!-- Javascript -->
    <script type="text/javascript" src="assets/admin/login-home/plugins/jquery-1.12.3.min.js"></script>
    <script type="text/javascript" src="assets/admin/login-home/plugins/bootstrap/js/bootstrap.min.js"></script>
    <script type="text/javascript"
        src="assets/admin/login-home/plugins/jquery-placeholder/jquery.placeholder.js"></script>

    <!-- <script src="./firebaseData.js"></script> -->
    <script src="./assets/js/bundle.js?ver=2.5.0"></script>
    <script src="./assets/js/scripts.js?ver=2.5.0"></script>
    <script src="./assets/js/charts/chart-ecommerce.js?ver=2.5.0"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-firestore.js"></script>
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyDlqNMzVsqHNTVzLAYSrsn4SjuUhZyOELc",
            authDomain: "e-restaurant-23034.firebaseapp.com",
            projectId: "e-restaurant-23034",
            storageBucket: "e-restaurant-23034.appspot.com",
            messagingSenderId: "411328100739",
            appId: "1:411328100739:web:ba4eb93d5f6828017f5eb6",
            measurementId: "G-WSW44TGVTM",
            databaseURL: "https://e-restaurant.firebaseio.com",
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const user = JSON.parse(sessionStorage.getItem('user'))

        // Function to populate the selection element
        async function populateSelect() {
            const selectElement = document.getElementById('menu-items');

            try {
                const querySnapshot = await db.collection('menus').get();
                querySnapshot.forEach((doc) => {
                    const data = doc.data();
                    const option = document.createElement('option');
                    option.value = data.name;
                    option.textContent = `${data.name} - $${data.price}`;
                    selectElement.appendChild(option);
                });
            } catch (error) {
                console.error('Error fetching documents: ', error);
            }
        }


        // Function to populate the table selection element
        async function populateTableSelect() {
            const selectElement = document.getElementById('order-table');

            try {
                // Fetch all documents from the 'tables' collection
                const tablesSnapshot = await db.collection('tables').get();
                const tables = tablesSnapshot.docs.map(doc => doc.data().name);

                // Fetch all documents from the 'orders' collection
                const ordersSnapshot = await db.collection('orders').get();
                const reservedTables = new Set(ordersSnapshot.docs.map(doc => doc.data()).filter(data => data.status === true).map(data => data.table));

                // Filter tables that are not in the referenced tables
                const unReservedTablesTables = tables.filter(table => !reservedTables.has(table));

                // Get the tbody element of the table with class 'tbls'
                const tbody = document.querySelector('.tbls tbody');

                // Clear any existing rows
                tbody.innerHTML = '';

                // Add rows for each table
                tables.forEach(table => {
                    const row = document.createElement('tr');
                    const cell = document.createElement('td');
                    const div = document.createElement('div');

                    div.textContent = table;
                    div.className = reservedTables.has(table) ? 'fill' : 'un-fill';

                    cell.appendChild(div);
                    row.appendChild(cell);
                    tbody.appendChild(row);
                });

                unReservedTablesTables.forEach(table => {
                    const option = document.createElement('option');
                    option.value = table;
                    option.textContent = `${table}`;
                    selectElement.appendChild(option);
                });

                console.log("Unreferenced Tables:", unReservedTablesTables);
            } catch (error) {
                console.error("Error getting documents: ", error);
            }
        }

        populateSelect();
        populateTableSelect();

        document.getElementById('pace-order').addEventListener('click', function (event) {
            event.preventDefault();

            // Retrieve input fields
            const billNo = document.getElementById('order-bill-no').value;
            const orderDate = document.getElementById('order-date').value;
            const orderTime = document.getElementById('order-time').value;
            const name = document.getElementById('order-name').value;
            const mobileNo = document.getElementById('order-mobile-no').value;
            const table = document.getElementById('order-table').value;
            const message = document.getElementById('order-message').value;

            console.log(table);

            if (!billNo || !orderDate || !orderTime || !name || !orderTime || !table) {
                alert("Please fill all info to palce order");
                return;
            }

            if (!window.menuItems || window.menuItems.length === 0) {
                alert("No items to save.");
                return;
            }

            // Prepare the data to be saved in Firestore
            const orderData = {
                billNo: billNo,
                orderDate: orderDate,
                orderTime: orderTime,
                customerName: name,
                customerMobileNo: mobileNo,
                table: table,
                message: message,
                items: window.menuItems,
                status: true,
                ready: false,
            };

            // Add the data to the Firestore collection 'orders'
            db.collection('orders').add(orderData)
                .then((docRef) => {
                    Swal.fire({
                        icon: 'success',
                        title: 'Order Placed Successfully!',
                        text: 'Your order has been placed. Thank you for choosing us! We’re preparing your items and will let you know when they’re ready.',
                        showConfirmButton: true,
                        confirmButtonText: 'Great!',
                        willClose: () => {
                            location.reload();
                        }
                    });


                    // Clear the inputs and menuItems array after saving
                    document.getElementById('order-bill-no').value = "";
                    document.getElementById('order-date').value = "";
                    document.getElementById('order-time').value = "";
                    document.getElementById('order-name').value = "";
                    document.getElementById('order-mobile-no').value = "";
                    document.getElementById('order-table').value = "";

                    // Optionally clear the menuItems array
                    window.menuItems.length = 0;

                    // Select all elements with the class 'my-class' and clear their inner HTML
                    $('.table-content').html('');

                })
                .catch((error) => {
                    console.error("Error adding document: ", error);
                    alert("Failed to save order to Firestore. Please try again.");
                });


        });


    </script>
    <!--LogOut Backend-->
    <script>
        function LogOut() {
            var userSession = sessionStorage.getItem('user')
            if (userSession) {
                sessionStorage.removeItem('user');
            }
            window.location.href = "../log-in.html";
        }


    </script>

    <!-- Add Menu items to table Fuction -->
    <script>
        window.menuItems = [];

        document.getElementById('btnn').addEventListener('click', function (event) {
            event.preventDefault();

            // Get input values
            const menuSelect = document.getElementById('menu-items');
            const menuItem = menuSelect.options[menuSelect.selectedIndex].text;

            const quantity = document.getElementById('menue-quantity').value;

            console.log(menuItem);
            console.log(quantity);


            if (menuItem === "Select Menu" || quantity === "") {
                alert("Please select a menu item and enter a quantity.");
                return;
            }

            // Extract unit price from menu item
            const parts = menuItem.split('-');
            console.log(parts);
            const unitPriceString = parts[1].replace('$', '').trim();
            const unitPrice = parseFloat(unitPriceString);

            // Total Price
            const totalPrice = unitPrice * quantity;

            // Get the table content
            const tableContent = document.querySelector('.table-content');

            // Create a new row
            const newRow = document.createElement('div');
            newRow.className = 'table-row';

            // Create an object to store the data
            const rowData = {
                menuName: parts[0].trim(),
                unitPrice: unitPrice.toFixed(2),
                quantity: quantity,
                totalPrice: totalPrice.toFixed(2)
            };

            // Add data to tableData array
            menuItems.push(rowData);

            // Create and insert cells
            newRow.innerHTML = `
                <div class="table-data">${tableContent.children.length + 1}</div>
                <div class="table-data">${parts[0]}</div>
                <div class="table-data">${unitPrice.toFixed(2)}</div>
                <div class="table-data">${quantity}</div>
                <div class="table-data">${totalPrice.toFixed(2)}</div>
            `;

            // Append the new row to the table content
            tableContent.appendChild(newRow);

            // Clear the form inputs
            document.getElementById('menu-items').value = "Select Menu";
            document.getElementById('menue-quantity').value = "";
        });

    </script>

</body>



</html>